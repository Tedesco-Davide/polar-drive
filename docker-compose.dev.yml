# docker-compose.dev.yml
# Configurazione SVILUPPO con SQL Server locale

services:
  api:
    container_name: polardrive-api-dev
    image: polardrive-api:latest
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=${CONNECTION_STRING}
      - TeslaApi__BaseUrl=http://mock-api:9090
      - TeslaApi__ClientId=${TESLA_CLIENT_ID}
      - TeslaApi__ClientSecret=${TESLA_CLIENT_SECRET}
      - Jwt__SecretKey=${JWT_SECRET_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - Jwt__ExpirationMinutes=${JWT_EXPIRATION_MINUTES}
      - Sms__Provider=Vonage
      - Sms__Api=SMS
      - Vonage__ApiKey=${VONAGE_API_KEY}
      - Vonage__ApiSecret=${VONAGE_API_SECRET}
      - Vonage__FromNumber=${VONAGE_FROM_NUMBER}
      - Vonage__InboundWebhookUrl=${VONAGE_INBOUND_WEBHOOK_URL}
      - Vonage__DlrWebhookUrl=${VONAGE_DLR_WEBHOOK_URL}
      - Vonage__WebhookSignature__Secret=${VONAGE_WEBHOOK_SIGNATURE_SECRET}
      - Vonage__WebhookSignature__Method=${VONAGE_WEBHOOK_SIGNATURE_METHOD}
      - Vonage__UseMessagesApi=${VONAGE_USE_MESSAGES_API}
    ports:
      - "8080:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - polardrive-network-dev

  mock-api:
    container_name: polardrive-mock-api-dev
    image: polardrive-mock:latest 
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - WebAPI__BaseUrl=http://api:8080
    ports:
      - "9090:9090"
    networks:
      - polardrive-network-dev

  frontend:
    container_name: polardrive-frontend-dev
    image: polardrive-frontend:latest
    environment:
      - NODE_ENV=production # Necessario per Next.js standalone
      - API_BACKEND_URL=http://host.docker.internal:${NEXT_PUBLIC_API_BASE}
    ports:
      - "3000:3000"
    networks:
      - polardrive-network-dev

networks:
  polardrive-network-dev:
    external: true